<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head><script src="/chris_beeley_blog/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=chris_beeley_blog/livereload" data-no-instant defer></script>
    
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>Uncategorized - Chris Beeley&#39;s blog</title>
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Chris Beeley\u0027s blog",
    
    "url": "http:\/\/localhost:1313\/chris_beeley_blog\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "http:\/\/localhost:1313\/chris_beeley_blog\/"
  
  
  
  
}
</script>

<meta property="og:url" content="http://localhost:1313/chris_beeley_blog/categories/Uncategorized/">
<meta property="og:type" content="website">
<meta property="og:site_name" content="Chris Beeley&#39;s blog">
   
<link rel="apple-touch-icon" sizes="180x180" href=" http://localhost:1313/chris_beeley_blog/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/chris_beeley_blog/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/chris_beeley_blog/favicon/favicon-16x16.png">


<meta name="generator" content="Hugo 0.124.1"><link rel="alternate" href="http://localhost:1313/chris_beeley_blog/index.xml" type="application/rss+xml" title="Chris Beeley&#39;s blog">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
<link rel="stylesheet" href="http://localhost:1313/chris_beeley_blog/css/main.css">
<link disabled id="dark-mode-theme" rel="stylesheet" href="http://localhost:1313/chris_beeley_blog/css/dark.css"><link rel="stylesheet" href="http://localhost:1313/chris_beeley_blog/css/syntax.css"><link rel="stylesheet" href="http://localhost:1313/chris_beeley_blog/css/codeblock.css">




  </head>
  <body>
    
<div class="container fixed-top">
  <div class="row justify-content-center">
    <div class="col-sm-12 col-md-12 col-lg-10 col-xl-10">

      <nav class="navbar navbar-expand-lg navbar-light fixed-top p-0">
        <div class="container">
          
          <a class="navbar-brand fw-bold" href="http://localhost:1313/chris_beeley_blog/">Chris Beeley&#39;s blog</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav mb-2 mb-lg-0">
              

              
              <li class="nav-item nav-link">
                <a id="dark-mode-toggle" class="bi bi-sun"></a>
              </li>
              
            </ul>
          </div>
        </div>
      </nav>

    </div>
  </div>
</div>
    









<header class="header-section ">

  <div class="intro-header no-img mt-10">
    <div class="container">
      <div class="row justify-content-center">
        

          
          <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
            

            <div class="categories-heading">
              

              

              

              
              

              

              
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-md-12">
       
      <div class="row">
        
          <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6  mb-4">
    <div class="card h-100 single-post-card shadow-effect bg-faded-light">
        <a href="http://localhost:1313/chris_beeley_blog/?p=1023/">
            <div class="card-body">

                <h3 class="fw-bold post-title">One editor to rule them all- Atom</h3>
                

                <p class="post-meta">
                    <span class="post-meta">
  
  
  &nbsp;July 2, 2017 

  

  
  
  
</span>


                </p>
                
                <div class="post-entry">

                    
                    <p>I‚Äôm very happy using RStudio for all my R code. It goes without saying that the support for R coding built into RStudio is phenomenal. If you don‚Äôt know loads of cool stuff RStudio does, you‚Äôre missing out, but that‚Äôs a blog post on its own.</p>
<p>I‚Äôve never quite been happy with my choice for other general editing, though. Sometimes I write PHP, HTML, markdown, Python, or something else, and I‚Äôve never really found an editor that I love. <a href="https://www.geany.org/">Geany</a> is pretty good and that‚Äôs what I have been using when I write PHP or HTML. I tended to write markdown in RStudio, which is kind of stupid, since RStudio is an awfully big hammer to crack that nut, but it does support markdown and I‚Äôm familiar with RStudio, so I was happy enough doing that. I never really found a Python IDE that I loved. As far as I can tell there isn‚Äôt really an RStudio equivalent in the Python world, something so well featured and brilliant that it‚Äôs really the only choice unless you have a very particular reason to use something else.</p>
<p>So about a year ago I gave <a href="https://atom.io/">Atom</a> a try. It had been out of beta for about a year by that point. I don‚Äôt really remember it clearly now but it seemed a bit clunky and I just rapidly gave up (to be fair, this may have just been me being thick, I‚Äôve no idea how much it has really improved since). It just didn‚Äôt grab me. I keep seeing it mentioned everywhere and I thought I would give it another go.</p>
<p>This time I was hooked straight away. It‚Äôs described as a ‚Äúhackable editor for the 21st Century‚Äù and that‚Äôs the real strength of it. The actual interface is very clean and simple, no bells and whistles, but it comes bundled with some plugins and there is a thriving ecosystem of user contributed packages that can make Atom, it seems so far, anything you want it to be.</p>
<p>I think I love Atom for the same reason I love R. It has a big ecosystem of packages around it, and whatever problem you want to solve, as Apple almost said of the iPhone, ‚Äúthere‚Äôs a package for that‚Äù.</p>
<p>Your needs will be different from mine, of course, but I recommend you give Atom a try if you haven‚Äôt already. It supports Markdown preview out of the box. So far I have installed two packages- platformio-ide-terminal, and script. Platformio-ide-terminal allows you to spawn a terminal underneath your code window, which I have been mainly using to run pandoc on my markdown files. Script will run your code for you (sections, the whole thing, etc.) all with a shortcut key. So far I‚Äôve been using that for testing Python scripts. Oh yes, and the markdown editor supports word completion out of the box too, not code, just normal words, which is more useful than it sounds.</p>
<p>While I‚Äôve been Googling Atom to find the links to put in this post I have found two really cool things that I didn‚Äôt know about. Firstly, there is the Hydrogen package, which allows Jupyter like functionality in Atom. If you don‚Äôt know what Jupyter is, you should find out, but essentially it allows you to weave together your code and output, just like you can with RMarkdown.</p>
<p>And secondly Atom themselves have just released <a href="http://blog.atom.io/2017/11/15/code-together-in-real-time-with-teletype-for-atom.html">teletype</a> which is a tool that allows collaboration on code files right inside the Atom editor. I don‚Äôt really need to do that, not that I can think of anyway, but you have to admit it‚Äôs pretty awesome. They‚Äôve solved a lot of the problems with code collaboration elsewhere, as well, have a look at the blog post for more details.</p>
<p>So go give Atom a try. I‚Äôll try to post any more Atom-related awesomeness that I see on my travels.</p>

                    
                </div>

                <div class="read-more-section">
                    <h6>Read more</h6>
                </div>
            </div>

            
            
        </a>
    </div>
</div> 
        
          <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6  mb-4">
    <div class="card h-100 single-post-card shadow-effect bg-faded-light">
        <a href="http://localhost:1313/chris_beeley_blog/?p=983/">
            <div class="card-body">

                <h3 class="fw-bold post-title">Lazy tables with R and pander</h3>
                

                <p class="post-meta">
                    <span class="post-meta">
  
  
  &nbsp;May 23, 2017 

  

  
  
  
</span>


                </p>
                
                <div class="post-entry">

                    
                    <p>One of the many things I love about R is how gloriously lazy it can help you to be. I‚Äôm writing a report at the moment and I need to make lots of tables in R Markdown. I need them to be proportions, expressed as a percentage, rounded to 0 decimal places, and I need to add (%) to each label on the table. That‚Äôs a lot of code when you‚Äôve got 8 or 10 tables to draw, so I just made a function that does it. It takes two arguments, the variable you want tabulated, and the order in which you want the table. I need to specify the order manually because the default alphabetical ordering doesn‚Äôt work with all of the data that I want, as in the example here. Without ordering manually, the ‚ÄúLess than one year‚Äù category appears at the end.</p>
<p>Here‚Äôs a minimal example:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;

library(pander)

niceTable = function(x, y) {
  
  tempTable = round(
    prop.table(
      table(
        factor(x, 
               levels = y)
      )
    ) * 100, 0)
  
  names(tempTable) = paste0(names(tempTable), &#34; (%)&#34;)
  
  pandoc.table(tempTable)
  
}

a = c(rep(&#34;Less than one year&#34;, 3), rep(&#34;1 - 5 years&#34;, 4), 
    rep(&#34;5 - 10 years&#34;, 2))

niceTable(a, c(&#34;Less than one year&#34;, 
    &#34;1 - 5 years&#34;, &#34;5 - 10 years&#34;))
</code></pre><p>Boom! Instant laziness. Unless my boss is reading, in which case it‚Äôs efficiency üôÇ</p>

                    
                </div>

                <div class="read-more-section">
                    <h6>Read more</h6>
                </div>
            </div>

            
            
        </a>
    </div>
</div> 
        
          <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6  mb-4">
    <div class="card h-100 single-post-card shadow-effect bg-faded-light">
        <a href="http://localhost:1313/chris_beeley_blog/?p=957/">
            <div class="card-body">

                <h3 class="fw-bold post-title">Quarters and modulo arithmetic</h3>
                

                <p class="post-meta">
                    <span class="post-meta">
  
  
  &nbsp;April 21, 2017 

  

  
  
  
</span>


                </p>
                
                <div class="post-entry">

                    
                    <p>This is another post that‚Äôs mainly for my benefit when I inevitably forget. I‚Äôm working with dates in PHP which, unlike MySQL, does not have a built in quarter function for extracting the quarter from a year.</p>
<p>Even if it did, one would have to be very careful with it because quarters are actually defined differently in different countries. In the UK, where I am, April to June is the first quarter (and January to March the last). In other countries, including (I think) the US, the first quarter is January to March, and October to December the last.</p>
<p>With no quarter function, and the hypothetical threat of an unpredictable one, my next recourse is to divide the month by 3 in order to give me a quarter number. This is done very simply as:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: php; title: ; notranslate&#34; title=&#34;&#34;&gt;

echo ceil(date(&#34;m&#34;) / 3);
</code></pre><p>This will return 1 when the month is 1 to 3 (January to March), 2 when it‚Äôs 4 to 6 (April to June) etc. But as I mentioned before UK quarters don‚Äôt work like this. We don‚Äôt have quarters in a sequence 1, 2, 3, 4. They go in a sequence like 4, 1, 2, 3. Now I could write code that deals with each of those cases individually, converting 1 to 4, 2 to 1, 3 to 2, etc., but I thought it was better to do it properly (and store up generalisability for the future) by converting the 1, 2, 3, 4 sequence with modulo arithmetic. I confess, I still can‚Äôt work out how to do this other than by trial and error but it definitely involves modulo 4 because the sequence is of period 4.</p>
<p>To convert 1, 2, 3, 4 to 4, 1, 2, 3 one need only do the following, where x is the input value 1, 2, 3, 4:</p>
<p>4 ‚Äì (5 ‚Äì x) %% 4</p>
<p>As far as I can figure it the first constant (4) tells the sequence how big it should be (4, 1, 2, 3 or 10, 7, 8, 9) and the second constant (5) tells the series where it should flip back to the start (4, 1, 2, 3 or 3, 4, 1, 2).</p>
<p>That‚Äôs all I know, I‚Äôm really busy and don‚Äôt have time to think about it any more. Hopefully this will help someone/ me in two years‚Äô time.</p>

                    
                </div>

                <div class="read-more-section">
                    <h6>Read more</h6>
                </div>
            </div>

            
            
        </a>
    </div>
</div> 
        
          <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6  mb-4">
    <div class="card h-100 single-post-card shadow-effect bg-faded-light">
        <a href="http://localhost:1313/chris_beeley_blog/?p=955/">
            <div class="card-body">

                <h3 class="fw-bold post-title">Consuming REST APIs with PHP and CURL</h3>
                

                <p class="post-meta">
                    <span class="post-meta">
  
  
  &nbsp;April 20, 2017 

  

  
  
  
</span>


                </p>
                
                <div class="post-entry">

                    
                    <p>I wasted such a lot of time on this that I must commit it to the internet on the off chance that it helps someone else in the same situation.</p>
<p>If you are using PHP to consume a RESTful API via CURL and you want to manipulate the data you get back it‚Äôs very important that you set CURLOPT_RETURNTRANSFER to true. This allows you to collect the response from the server in a variable. If you don‚Äôt set this option it will just echo the return to the screen, which is obviously of no use whatsoever.</p>
<p>While I‚Äôm here I may as well mention as well that if you want json_decode to return an array you need to use json_decode($result, true); otherwise you get an object back. The final code I wrote looks like this:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: php; title: ; notranslate&#34; title=&#34;&#34;&gt;

$ch = curl_init();
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_URL, &#34;http://YOUR_URL_HERE&#34;);
$result = curl_exec($ch);

curl_close($ch);

$result = json_decode($result, true); // giving true to json_decode returns array
</code></pre>
                    
                </div>

                <div class="read-more-section">
                    <h6>Read more</h6>
                </div>
            </div>

            
            
        </a>
    </div>
</div> 
        
          <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6  mb-4">
    <div class="card h-100 single-post-card shadow-effect bg-faded-light">
        <a href="http://localhost:1313/chris_beeley_blog/?p=936/">
            <div class="card-body">

                <h3 class="fw-bold post-title">Converting a grouped plyr::ddply() to dplyr</h3>
                

                <p class="post-meta">
                    <span class="post-meta">
  
  
  &nbsp;April 13, 2017 

  

  
  
  
</span>


                </p>
                
                <div class="post-entry">

                    
                    <p>I‚Äôm going full <a href="http://tidyverse.org/">tidyverse</a> at the moment and so I‚Äôm converting my old plyr code to dplyr. It‚Äôs been pretty steady going so far, although I had a bit of difficulty converting an instruction using ddply which carried out a function based on a subgrouping within the data. I wrote a toy example to get it right, I may as well share it with the internet in case it helps someone else. If you can‚Äôt figure out what I‚Äôm talking about with what the function does, just run the code. You‚Äôll see what it is. Easier than explaining in words. The following two functions carry out the same task, the latter is a translation of the former.</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;

library(plyr)
library(tidyverse)

plyr::ddply(mtcars, &#34;cyl&#34;, mutate, mean.mpg = mean(mpg))

mtcars %&gt;% 
  dplyr::group_by(cyl) %&gt;% 
  dplyr::mutate(mean.mpg = mean(mpg))
</code></pre>
                    
                </div>

                <div class="read-more-section">
                    <h6>Read more</h6>
                </div>
            </div>

            
            
        </a>
    </div>
</div> 
        
          <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6  mb-4">
    <div class="card h-100 single-post-card shadow-effect bg-faded-light">
        <a href="http://localhost:1313/chris_beeley_blog/?p=904/">
            <div class="card-body">

                <h3 class="fw-bold post-title">Munging Patient Opinion data with R</h3>
                

                <p class="post-meta">
                    <span class="post-meta">
  
  
  &nbsp;March 10, 2017 

  

  
  
  
</span>


                </p>
                
                <div class="post-entry">

                    
                    <p>I‚Äôve written a post about using Patient Opinion‚Äôs new API, focusing on how to download your data using R but also perhaps useful to those using other languages as a gentle introduction, which can be found <a href="http://chrisbeeley.net/?p=886">here</a>.</p>
<p>This post focuses on the specific data operations which I perform in R in order to get the data nicely formatted and stored on our server. This may be of interest to those using R who want to do something very similar, much of this code will probably work in a similar context.</p>
<p>The code shown checks for the most recent Patient Opinion data every night and, if there is new data that is not yet on the database, downloads and processes it and uploads it to our own database. In the past I had downloaded the whole set every night and simply wiped the previous version, but this is not possible now we are starting to add our own data codes to the Patient Opinion data (enriching the metadata, for example by improving the match to our service tree all the way to team level where possible).</p>
<p>First things first, we‚Äôll be using the lappend function, which I <a href="http://stackoverflow.com/questions/2436688/append-an-object-to-a-list-in-r-in-amortized-constant-time">stole from StackExchange</a> a very long time ago and use all the time. I‚Äôve often thought of starting a campaign to get it included in base R but then I thought lots of people must have that idea about other functions and it probably really annoys the base R people, so I just define it whenever I need to use it. One day I will set up a proper <a href="http://www.onthelambda.com/2014/09/17/fun-with-rprofile-and-customizing-r-startup/">R starting environment</a> and include it in there, I use R on a lot of machines and so have always been frightened to open that particular can of worms.</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;

library(httr)
library(RMySQL)

### lappend function

lappend &lt;- function(lst, obj) {

¬† lst[[length(lst)+1]] &lt;- obj

¬† return(lst)
}
</code></pre><p>Now we store our api key somewhere where we can get it again and query our database to see the date of the most recent Patient Opinion story. We will issue a dbDisconnect(mydb) right at the end after we have finished the upload. Note that we add one to the date because we only want stories that are more recent than the database, and the API searches on dates after and <em>including</em> the given date.</p>
<p>We need to convert this date into a string like the following ‚Äú01%2F08%2F2015‚Äù because this is the format the API accepts dates in. This date is the 1st August 2015.</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;

apiKey = &#34;SUBSCRIPTION_KEY qwertyuiop&#34;

# connect to database

theDriver &lt;- dbDriver(&#34;MySQL&#34;)

mydb = dbConnect(theDriver, user = &#34;myusername&#34;, password = &#34;mypassword&#34;,
¬† dbname = &#34;dbName&#34;, host = &#34;localhost&#34;)

dateQuery = as.Date(dbGetQuery(mydb, &#34;SELECT MAX(Date) FROM POFinal&#34;)[, 1]) + 1

dateFinal = paste0(substr(dateQuery, 6, 7), &#34;%2F&#34;, substr(dateQuery, 9, 10), &#34;%2F&#34;, substr(dateQuery, 1, 4))
</code></pre><p>Now it‚Äôs time to fetch the data from Patient Opinion and process it. We will produce an empty list and then add 100 stories to it (the maximum number the API will return from a single request), using a loop to take the next hundred, and the next hundred, until there are no more stories (it‚Äôs highly unlikely that there would be over 100 stories just in one day, obviously, but no harm in making the code cope with such an eventuality).</p>
<p>The API accepts a value of skip which allows you to select which story you want, in order of appearance, so this is set at 0, and then 100, and then 200, and so on within a loop to fetch all of the data.</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;

# produce empty list to lappend

opinionList = list()

# set skip at 0 and make continue TRUE until no stories are returned

skip = 0

continue = TRUE

while(continue){

¬† opinions = GET(paste0(&#34;https://www.patientopinion.org.uk/api/v2/opinions?take=100&amp;skip=&#34;,
¬† skip, &#34;&amp;submittedonafter=&#34;, dateFinal),
¬† add_headers(Authorization = apiKey))

¬† if(length(content(opinions)) == 0){ # if there are no stories then stop

¬† continue = FALSE
¬† }

¬† opinionList = c(opinionList, content(opinions)) # add the stories to the list
¬† # increase skip, and repeat

¬† skip = skip + 100

}
</code></pre><p>Having done this we test to see if there are any stories since yesterday. If there are, the length of opinionList will be greater than 0 (that is, length(opinionList) &gt; 0). If there are we extract the relevant bits we want from each list ready to build it into a dataframe</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;
# if there are no new stories just miss this entire bit out

if(length(opinionList) &gt; 0){

¬† keyID = lapply(opinionList, &#34;[[&#34;, &#34;id&#34;)
¬† title = lapply(opinionList, &#34;[[&#34;, &#34;title&#34;)
¬† story = lapply(opinionList, &#34;[[&#34;, &#34;body&#34;)
¬† date = lapply(opinionList, &#34;[[&#34;, &#34;dateOfPublication&#34;)
¬† criticality = lapply(opinionList, &#34;[[&#34;, &#34;criticality&#34;)
</code></pre><p>The service from which each story originates is slightly buried inside opinionList, and you‚Äôll need to step through with lapply, extracting the $links element, and then take the object that results and step through it, taking the 5th list element and extracting the element named ‚Äúid‚Äù. This actually makes more sense to explain in code:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;
# location is inside $links

linkList = lapply(opinionList, &#34;[[&#34;, &#34;links&#34;)
location = lapply(linkList, function(x) x[[5]][[&#39;id&#39;]])

# Some general tidying up and we&#39;re ready to put in a dataframe

# there are null values in some of these, need converting to NA
# before they&#39;re put in the dataframe

date[sapply(date, is.null)] = NA
criticality[sapply(criticality, is.null)] = NA

finalData = data.frame(&#34;keyID&#34; = unlist(keyID),
  &#34;Title&#34; = unlist(title),
  &#34;PO&#34; = unlist(story),
  &#34;Date&#34; = as.Date(substr(unlist(date), 1, 10)),
  &#34;criticality&#34; = unlist(criticality),
  &#34;location&#34; = unlist(location),
  stringsAsFactors = FALSE
)
</code></pre><p>Now we have the data in a dataframe it‚Äôs time to match up the location codes that Patient Opinion use with the codes that we use internally. There‚Äôs nothing earth shattering in the code so I won‚Äôt laboriously explain it all, there may be a few lines in it that could help you with your own data.</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;
### match up NACS codes

POLookup = read.csv(&#34;poLookup.csv&#34;, stringsAsFactors = FALSE)

### some of the cases are inconsistent, make them all lower case

finalData$location = tolower(finalData$location)

POLookup$NACS = tolower(POLookup$NACS)

PO1 = merge(finalData, POLookup, by.x = &#34;location&#34;, by.y = &#34;NACS&#34;, all.x = TRUE)

### clean the data, removing HTML tags

PO1$PO = gsub(&#34;&lt;(.|\n)*?&gt;&#34;, &#34;&#34;, PO1$PO)

PO1$Date = as.Date(PO1$Date)

poQuarters = as.numeric(substr(quarters(PO1$Date), 2, 2))

poYears = as.numeric(format(PO1$Date, &#34;%Y&#34;))

PO1$Time = poQuarters + (poYears - 2009) * 4 - 1

### write PO to database

# all team codes must be present

PO1 = PO1[!is.na(PO1$TeamC), ]

# strip out line returns

PO1$PO = gsub(pattern = &#34;\r&#34;, replacement = &#34;&#34;, x = PO1$PO)
</code></pre><p>The following line is perhaps the most interesting. There are some smileys in our data, encoded in UTF-8, and I don‚Äôt know exactly why but RMySQL is not playing nicely with them. I‚Äôm sure there is a clever way to sort this problem but I have a lot of other work to do so I confess I just destroyed them as follows</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;
# strip out the UTF-8 smileys

PO1$PO = iconv(PO1$PO, &#34;ASCII&#34;, &#34;UTF-8&#34;, sub = &#34;&#34;)
</code></pre><p>And with all that done we can use dbWriteTable to upload the data to the database</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;
# write to database

dbWriteTable(mydb, &#34;POFinal&#34;, PO1[, c(&#34;keyID&#34;, &#34;Title&#34;, &#34;PO&#34;, &#34;Date&#34;, &#34;Time&#34;,
             &#34;TeamC&#34;)], append = TRUE, row.names = FALSE)
}
</code></pre><p>That‚Äôs it! All done</p>

                    
                </div>

                <div class="read-more-section">
                    <h6>Read more</h6>
                </div>
            </div>

            
            
        </a>
    </div>
</div> 
        
      </div>
    </div>
  </div>
</div>

<div class="container">
 <div class="row font-sans"> 
   <div class="col-md-12 mt-10">
      <nav aria-label="Page navigation"> 
      <ul class= "pagination justify-content-end">    
      
    <ul class="pagination pagination-default">
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/" aria-label="First" class="page-link" role="button"><span aria-hidden="true">&laquo;&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/13/" aria-label="Previous" class="page-link" role="button"><span aria-hidden="true">&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/12/" aria-label="Page 12" class="page-link" role="button">12</a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/13/" aria-label="Page 13" class="page-link" role="button">13</a>
      </li>
      <li class="page-item active">
        <a aria-current="page" aria-label="Page 14" class="page-link" role="button">14</a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/15/" aria-label="Page 15" class="page-link" role="button">15</a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/16/" aria-label="Page 16" class="page-link" role="button">16</a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/15/" aria-label="Next" class="page-link" role="button"><span aria-hidden="true">&raquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/29/" aria-label="Last" class="page-link" role="button"><span aria-hidden="true">&raquo;&raquo;</span></a>
      </li>
    </ul> 
      </ul>
      </nav> 
    </div>
  </div>
</div>


    


<footer>

  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <ul
          class="list-inline list-group list-group-horizontal text-center footer-links d-flex justify-content-center flex-row">

          
          
        </ul>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;&copy;
          
          2023
          

          
          &nbsp;&bull;&nbsp;
          <a href="http://localhost:1313/chris_beeley_blog/">Chris Beeley&#39;s blog</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          Powered by <a href="https://gohugo.io">Hugo</a> & <a href="https://github.com/binokochumolvarghese/lightbi-hugo">Lightbi.</a>&nbsp; Made with ‚ù§ by <a href="https://binovarghese.com">Bino</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha256-tG5mcZUtJsZvyKAxYLVXrmjKBVLd6VpVccqz/r4ypFE=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js" integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ" crossorigin="anonymous"></script><script src="http://localhost:1313/chris_beeley_blog/js/dark-mode.js"></script>
    
  </body>
</html>

