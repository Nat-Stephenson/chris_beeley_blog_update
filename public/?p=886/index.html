<!DOCTYPE html>
<html><head><script src="/chris_beeley_blog/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=chris_beeley_blog/livereload" data-no-instant defer></script>

  <title>Querying the Patient Opinion API from R | Chris Beeley&#39;s blog</title>


  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <link rel="icon" href="../favicon.ico">



  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>

  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>




  </head>
<body><nav class="navbar navbar-expand-lg navbar-light ">

  <a class="navbar-brand" href="../">Chris Beeley&#39;s blog</a>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">

    <span class="navbar-toggler-icon"></span>

  </button>



  <div class="collapse navbar-collapse" id="navbarSupportedContent">

    <ul class="navbar-nav ml-auto">

      

      

        <li class="navbar-item ">

          <a class="nav-link" href="../chris_beeley_blog/posts/" title="posts">posts</a>

        </li>

      

        <li class="navbar-item ">

          <a class="nav-link" href="https://github.com/ChrisBeeley/chris_beeley_blog" title="GitHub">github</a>

        </li>

      

    </ul>

  </div>

</nav>
  <h1>Querying the Patient Opinion API from R</h1>

  
  
  <time datetime="2017-03-10T11:28:06&#43;00:00">March 10, 2017</time>

  <p><a href="https://www.patientopinion.org.uk/">Patient Opinion</a> have a new API out. They are retiring the old API, so you’ll need to transfer over to the new one if you are currently using the old version, but in any case there are a number of advantages to doing so. The biggest one for me is the option to receive results in JSON (or JSONP) rather than XML (although you can still have XML if you want). The old XML output was fiddly and annoying to parse so personally I’m glad to see the back of it (you can see the horrible hacky code I wrote to parse the old version <a href="http://chrisbeeley.net/?p=487">here</a>). The JSON comes out beautifully using the built in functions from the R package <a href="https://cran.r-project.org/web/packages/httr/index.html">httr</a> which I shall be using to download and process the data.</p>
<p>There is a lot more information in the new API as well, including tags, the URL of the story, responses, status of the story (has response, change planned, etc.). I haven’t even remotely begun to think of all the new exciting things we can do with all this information, but I confess to being pretty excited about it.</p>
<p>With all that said, let’s have a look at how we can get this data into R with the minimum of effort. If you’re not using R, hopefully this guide may be of some use to you to show you the general direction of travel, whichever language you’re using.</p>
<p>This guide should be read in conjunction with the excellent API documentation at Patient Opinion which can be found <a href="https://www.patientopinion.org.uk/info/api-v2">here</a>.</p>
<p>First things first, let’s get access to the API. You’ll need a key which can be obtained <a href="https://www.patientopinion.org.uk/mysubscriptions">here</a>. Get the HTTP one, not the Uri version which only lasts for 24 hours.</p>
<p>We’ll be using the HTTP protocol to access the API, there’s a nice introduction to HTTP linked from the <a href="https://cran.r-project.org/web/packages/httr/vignettes/quickstart.html">httr</a> package <a href="http://code.tutsplus.com/tutorials/http-the-protocol-every-web-developer-must-know-part-1--net-31177">here</a>. We will be using the aforementioned httr package in order to make requests using the HTTP protocol.</p>
<p>Let’s get started</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;

# put the subscription key header somewhere (this is not a real API key, of course, insert your own here)

apiKey = &#34;SUBSCRIPTION_KEY qwertyuiop&#34;

# run the GET command using add_headers to add the authentication header

stories = GET(&#34;https://www.patientopinion.org.uk/api/v2/opinions?take=100&amp;skip=0&#34;,
              add_headers(Authorization = apiKey))
</code></pre><p>This will return the stories in the default JSON format. If you prefer XML, which I strongly advise you don’t, fetch the stories like this:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;
stories = GET(&#34;https://www.patientopinion.org.uk/api/v2/opinions?take=100&amp;skip=0&#34;,
add_headers(Authorization = apiKey, Accept = &#34;text/xml&#34;) )
</code></pre><p>For those of you who are using something other than R to access the API, note that the above add_headers() command is equivalent to adding the following to your HTTP header:</p>
<p>Authorization: SUBSCRIPTION_KEY qwertyuiop</p>
<p>You can extract the data from the JSON or XML object which is returned very simply by using:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;
storiesList = content(stories)
</code></pre><p>This will return the data in a list. There is more on extracting the particular data that you want in another blog post which is parallel to this one <a href="http://chrisbeeley.net/?p=904">here</a>, for brevity we can say here that you can return all the titles by running:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;
title = lapply(opinionList, &#34;[[&#34;, &#34;title&#34;)
</code></pre><p>That’s it. You’re done. You’ve done it. There’s loads more about <a href="https://www.patientopinion.org.uk/info/api-v2-content">what’s available</a> and <a href="https://www.patientopinion.org.uk/info/api-v2-filtering">how to search</a> it in the help pages, hopefully this was a useful intro for R users.</p>

  

<footer class="footer mt-5">

  <div class="container">

    <table class="table table-sm">

      <caption>Hugo Variables for current page</caption>

      <tr><th>Name</th><td>Querying the Patient Opinion API from R</td></tr>

      <tr><th>Kind</th><td>page</td></tr>

      <tr><th>Type</th><td>posts</td></tr>

      <tr><th>List Page</th><td>.Pages</td></tr>

      <tr><th>IsPage</th><td>true</td></tr>

      <tr><th>IsHome</th><td>true</td></tr>

      <tr><th>Next</th><td>/Users/NatsSpace/chris_beeley_blog_update/content/posts/2017-03-10-munging-patient-opinion-data-with-r.md</td></tr>

      <tr><th>Prev</th><td>/Users/NatsSpace/chris_beeley_blog_update/content/posts/2017-01-12-concatenating-text-nicely-with-commas-and-ands.md</td></tr>

      <tr><th>Section</th><td>/Users/NatsSpace/chris_beeley_blog_update/content/posts/_index.md</td></tr>

    </table>

  </div>

</footer></body>
</html>
